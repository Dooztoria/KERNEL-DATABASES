#!/bin/bash
K=$(uname -r)
A=$(uname -m)
U=$(id -u)
E=()
check(){
    local cve=$1 name=$2 rate=$3 cond=$4
    if eval "$cond" 2>/dev/null;then E+=("{\"cve\":\"$cve\",\"name\":\"$name\",\"rate\":$rate}");fi
}
check "CVE-2021-4034" "PwnKit" 99 '[ -u /usr/bin/pkexec ]'
check "CVE-2022-0847" "DirtyPipe" 95 '[[ "$K" > "5.8" && "$K" < "5.17" ]]'
check "CVE-2016-5195" "DirtyCOW" 85 '[[ "$K" < "4.9" ]]'
check "CVE-2022-2588" "DirtyCred" 80 '[[ "$K" > "5.8" ]]'
check "CVE-2023-0386" "OverlayFS" 75 '[[ "$K" > "5.11" && "$K" < "6.2" ]]'
check "CVE-2021-3156" "Baron Samedit" 90 'sudo --version 2>/dev/null | grep -q "1\.[89]"'
check "CVE-2019-14287" "Sudo Bypass" 70 'sudo --version 2>/dev/null | grep -q "1\.8\.[0-9]\{1,2\}"'
printf '{"exploits":['
for i in "${!E[@]}";do
    [[ $i -gt 0 ]] && printf ','
    printf '%s' "${E[$i]}"
done
printf ']}'
